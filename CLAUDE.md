# Ink Battles - Claude AI 助手指南

## 项目概述

Ink Battles 是一个基于 Next.js 的 AI 驱动写作分析和对战场景的 Web 应用。该应用具有用户认证、实时文本分析和基于 shadcn/ui 组件的现代化 UI。

## 开发环境

- **框架**: Next.js 15.4.4 with App Router
- **语言**: TypeScript
- **数据库**: MongoDB
- **认证**: 自定义 JWT 系统
- **UI**: shadcn/ui with Tailwind CSS
- **包管理器**: pnpm
- **AI 集成**: OpenAI API

---

默认情况下你应该按需阅读以下内容：

## 代码风格规范

详细规范请参考 `.ai/codeStyle.md`

## 架构指南

详细规范请参考 `.ai/functionStyle.md`

## 数据库规范

详细规范请参考 `.ai/database.md`

## UI 组件标准

详细规范请参考 `.ai/uiStyle.md`

## Git 提交规范

详细规范请参考 `.ai/commit.md`

## 文案规范

拒绝使用emoji表情，拒绝使用不规范的标点符号

## 记忆管理

详细规范请参考 `.ai/memange.md`

---

## 测试和质量

- **代码检查**: 提交前运行 `pnpm eslint . --fix`
- **TypeScript**: 启用严格类型检查
- **代码审查**: 遵循既定模式和规范
- **性能**: 优化服务器端渲染和流式传输以及内存使用（重要）
    - 内存使用：
        - 鉴于 Next.js 的 SSR 特性，内存使用非常重要，需要避免内存泄漏和过度占用，以防止服务器崩溃。
        - **规范提示**：
            - 禁止在全局作用域中存放大对象或缓存（应使用缓存策略或 LRU 缓存）。
            - 对外部资源（文件句柄、数据库连接、流）必须显式关闭或释放。
            - 优先使用 **流式处理**（streaming）而不是一次性加载到内存。
            - 避免 JSON.stringify 大对象，可分块传输或分页。
            - 在使用缓存时设定合理的 **过期时间** 和 **最大内存限制**。
            - 对 `Buffer`、`Map`、`Set` 等持久驻留内存的结构进行大小控制。
            - 必须在代码审查时确认关键模块（如 SSR 渲染、API 返回、数据库查询）不会导致内存持续增长。


## 安全考虑

- **认证**: 基于 JWT 的认证，包含适当的验证
- **输入验证**: 验证所有用户输入
- **数据库安全**: 通过 `db.ts` 使用参数化查询
- **API 安全**: 适当的错误处理和速率限制

## AI 集成

- **OpenAI API**: 用于文本分析和生成
- **流式传输**: 实时响应流式传输以提供更好的用户体验
- **错误处理**: 优雅地处理 API 故障和超时
- **令牌管理**: 适当的验证和使用跟踪

## 部署

- **Docker**: 使用 Dockerfile 进行容器化部署
- **环境**: 使用环境变量进行配置
- **数据库**: MongoDB 具有适当的连接管理
- **静态资源**: 通过 Next.js 构建过程优化
